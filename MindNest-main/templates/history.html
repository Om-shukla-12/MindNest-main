<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Journal History</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='footer.css') }}">
    
    <style>
        /* Sentiment Tag Colors */
        .tag-positive { background-color: #28a745; color: white; }
        .tag-negative { background-color: #dc3545; color: white; }
        .tag-neutral { background-color: #6c757d; color: white; }

        /* Emotion Tag Colors */
        .tag-joy, .tag-excitement, .tag-love, .tag-gratitude { background-color: #ffc107; color: #212529; }
        .tag-sadness, .tag-disappointment, .tag-grief { background-color: #007bff; color: white; }
        .tag-nervousness, .tag-fear { background-color: #6f42c1; color: white; }
        .tag-anger { background-color: #c82333; color: white; }
        .tag-surprise { background-color: #17a2b8; color: white; }
        .tag-disgust { background-color: #5a6268; color: white; }

        /* Fade-out animation for deleted entries */
        .entry-card.deleting {
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            opacity: 0;
            transform: scale(0.95);
        }
    </style>
</head>
<body>
<nav>
    <div class="nav-container">
        <span class="logo">ðŸ§  MindNest</span>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/dashboard">Dashboard</a>
            <a href="/history">History</a>
            <a href="/analyze_face">Face Emotion</a>
             <a href="{{ url_for('export_csv') }}" class="btn export-btn">Export as CSV</a>
            {% if session.get('logged_in') %}
                <a href="{{ url_for('logout') }}" class="nav-auth">Logout</a>
                {% if session.get('user_picture') %}
                    <img src="{{ session.get('user_picture') }}" alt="{{ session.get('user_name') }}" class="nav-avatar" style="width:32px;height:32px;border-radius:50%;object-fit:cover;margin-left:12px;border:2px solid rgba(255,255,255,0.6);" />
                {% endif %}
            {% else %}
                <a href="{{ url_for('login') }}" class="nav-auth">Login</a>
            {% endif %}
        </div>
    </div>
</nav>

<div class="history-container">
    <h1>Journal History</h1>

    {% for entry in entries %}
    <div class="entry-card" id="entry-{{ entry.id }}">
        <div class="timestamp">{{ entry.date.strftime('%B %d, %Y, %I:%M %p') }}</div>
        <div class="text">{{ entry.text }}</div>

        <div class="tags">
            <span class="tag mood-tag tag-{{ entry.sentiment|lower }}">ðŸ˜Š Mood: {{ entry.sentiment }}</span>
            <span class="tag emotion-tag tag-{{ entry.emotion|lower }}">ðŸŒˆ Emotion: {{ entry.emotion }}</span>
        </div>

        {% if entry.suggestion %}
        <div class="suggestion"><i>{{ entry.suggestion }}</i></div>
        {% endif %}

        <div class="actions">
            <form action="/edit/{{ entry.id }}" method="GET" style="display: inline;">
                <button type="submit" class="btn edit">Edit</button>
            </form>
            <button onclick="deleteEntry({{ entry.id }})" class="btn delete">Delete</button>
        </div>
    </div>
    {% endfor %}
</div>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-left">
            <span class="footer-logo">ðŸ§  MindNest</span><br>
            <span style="font-size:0.97em;color:#e3f2fd;">&copy; 2025 MindNest. All rights reserved.</span>
        </div>
        <div class="footer-center">
            <a href="/about">About</a>
            <a href="/contact">Contact</a>
            <a href="/privacy">Privacy Policy</a>
            <a href="/terms">Terms</a>
        </div>
        <div class="footer-right">
            <span>Follow us:</span>
            <a href="https://twitter.com/" target="_blank" aria-label="Twitter"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitter.svg" alt="Twitter" style="height:20px;width:20px;vertical-align:middle;"></a>
            <a href="https://facebook.com/" target="_blank" aria-label="Facebook"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook" style="height:20px;width:20px;vertical-align:middle;"></a>
            <a href="mailto:support@mindnest.com" aria-label="Email"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/maildotru.svg" alt="Email" style="height:20px;width:20px;vertical-align:middle;"></a>
        </div>
    </div>
</footer>

<script>
function deleteEntry(id) {
    if (confirm('Are you sure you want to permanently delete this entry?')) {
        // Find the card element
        const entryCard = document.getElementById('entry-' + id);
        
        // Add a class to trigger the fade-out animation
        if (entryCard) {
            entryCard.classList.add('deleting');
        }

        fetch(`/delete/${id}`, { method: 'POST' })
            .then(response => {
                if (response.ok) {
                    // Wait for the animation to finish before removing the element
                    setTimeout(() => {
                        if (entryCard) {
                            entryCard.remove();
                        }
                    }, 500); // This duration should match the CSS transition time
                } else {
                    alert('Error: Could not delete the entry.');
                    // If deletion fails, remove the animation class
                    if (entryCard) {
                        entryCard.classList.remove('deleting');
                    }
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('An error occurred. Please try again.');
                if (entryCard) {
                    entryCard.classList.remove('deleting');
                }
            });
    }
}
</script>

</body>
</html>